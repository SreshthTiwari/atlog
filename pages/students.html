<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../styling/common.css" />
    <link
      href="https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="icon" type="image/x-icon" href="../images/logo.png" />
    <title>Student Info</title>
  </head>
  <body>
    <nav class="sidebar">
      <header>
        <div class="image-text">
          <span class="image">
            <img src="../images/logo.png" alt="" />
          </span>

          <div class="text logo-text">
            <span class="name">Backend</span>
          </div>
        </div>
      </header>

      <div class="menu-bar">
        <div class="menu">
          <ul class="menu-links">
            <li class="nav-link">
              <a href="../pages/home.html">
                <i class="bx bx-home-alt icon"></i>
                <span class="text nav-text">Home</span>
              </a>
            </li>

            <li class="nav-link">
              <a href="../pages/carer.html">
                <i class="bx bx-list-ul icon"></i>
                <span class="text nav-text">Carer Info</span>
              </a>
            </li>

            <li class="nav-link">
              <a href="../pages/students.html">
                <i class="bx bxs-school icon"></i>
                <span class="text nav-text">Student Info</span>
              </a>
            </li>

            <li class="nav-link">
              <a href="../pages/help.html">
                <i class="bx bx-question-mark icon"></i>
                <span class="text nav-text">Help</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="bottom-content">
          <li class="">
            <a href="../index.html" id="logout">
              <i class="bx bx-log-out icon"></i>
              <span class="text nav-text">Logout</span>
            </a>
          </li>

          <li class="mode">
            <div class="sun-moon">
              <i class="bx bx-moon icon moon"></i>
              <i class="bx bx-sun icon sun"></i>
            </div>
            <span class="mode-text text">Dark mode</span>

            <div class="toggle-switch">
              <span class="switch"></span>
            </div>
          </li>
        </div>
      </div>
    </nav>

    <section class="home">
      <form action="#">
        <div class="main">
          <div class="text">Student Information</div>
          <div class="route">
            Route:
            <select name="route" id="routeno">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
              <option value="12">12</option>
              <option value="13">14</option>
              <option value="15">15</option>
              <option value="16">16</option>
              <option value="17">17</option>
              <option value="18">18</option>
              <option value="19">19</option>
              <option value="20">20</option>
              <option value="21">21</option>
              <option value="22">22</option>
              <option value="23">23</option>
              <option value="24">24</option>
              <option value="25">25</option>
              <option value="26">26</option>
            </select>
          </div>
          <div class="info">
            <table id="studentinfo">
              <tr>
                <th>Student Name</th>
                <th>Grade</th>
                <th>Route</th>
              </tr>
              <tbody id="tbody1"></tbody>
            </table>
          </div>
        </div>
      </form>
    </section>
    <script type="module">
      import {
        getAuth,
        signOut,
      } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-auth.js";

      import {
        ref,
        onValue,
      } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-database.js";
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-app.js";
      import {
        getDatabase,
        set,
        get,
        child,
      } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-database.js";

      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyAKQ7x0iXdc9zPASPl8fe0Zy3w977sslwQ",
        authDomain: "schooltransportthingtest.firebaseapp.com",
        databaseURL:
          "https://schooltransportthingtest-default-rtdb.firebaseio.com",
        projectId: "schooltransportthingtest",
        storageBucket: "schooltransportthingtest.appspot.com",
        messagingSenderId: "1022909830472",
        appId: "1:1022909830472:web:14e6c0005a15bcfbed4f7d",
        measurementId: "G-9477HH598G",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const auth = getAuth();

      var logoutlink = document.getElementById("logout");

      var tbody = document.getElementById("tbody1");

      function addtotable(name, grade, route) {
        let trow = document.createElement("tr");
        let td1 = document.createElement("td");
        let td2 = document.createElement("td");
        let td3 = document.createElement("td");

        td1.innerHTML = name;
        td2.innerHTML = grade;
        td3.innerHTML = route;

        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);

        tbody.appendChild(trow);
      }

      function addalltotable(student) {
        tbody.innerHTML = "";
        student.forEach((element) => {
          addtotable(element.Name, element.Grade, element.RouteNo);
        });
        // console.log(student[0]);
      }

      const route = document.getElementById("routeno");
      route.onchange = getdata;

      function getdata() {
        // const dbref = ref(
        //   db,
        //   "Students/".concat(route.options[route.selectedIndex].text)
        // );

        const dbref = ref(db);

        get(
          child(
            dbref,
            "Students/".concat(route.options[route.selectedIndex].text)
          )
        ).then((snapshot) => {
          var students = [];
          snapshot.forEach((childsnap) => {
            students.push(childsnap.val());
          });
          console.log(students);
          addalltotable(students);
        });
        // onValue(dbref, (snapshot) => {
        //   var students = [];
        //   snapshot.forEach((childsnap) => {
        //     students.push(childsnap.val());
        //   });
        //   console.log(students);
        //   addalltotable(students);
        // });
      }

      window.onload = getdata;

      logoutlink.addEventListener("click", function () {
        const auth = getAuth();
        signOut(auth)
          .then(() => {
            // Sign-out successful.
          })
          .catch((error) => {
            alert("error");
          });
      });

      const body = document.querySelector("body"),
        img = body.querySelector(".image"),
        sidebar = body.querySelector("nav"),
        modeSwitch = body.querySelector(".toggle-switch"),
        modeText = body.querySelector(".mode-text");

      modeSwitch.addEventListener("click", () => {
        body.classList.toggle("dark");

        if (body.classList.contains("dark")) {
          modeText.innerText = "Light mode";
          img.innerHTML = '<img src="../images/darklogo.png" alt="" />';
        } else {
          modeText.innerText = "Dark mode";
          img.innerHTML = '<img src="../images/logo.png" alt="" />';
        }
      });
    </script>
  </body>
</html>
